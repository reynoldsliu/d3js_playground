<div class="tree-container">
  <div class="controls-panel">
    <div class="zoom-controls">
      <button (click)="zoomIn()" title="放大">
        <i class="fa fa-search-plus"></i> 放大
      </button>
      <button (click)="zoomOut()" title="縮小">
        <i class="fa fa-search-minus"></i> 縮小
      </button>
      <button (click)="resetZoom()" title="重置視圖">
        <i class="fa fa-expand"></i> 重置
      </button>
    </div>

    <div class="tree-actions">
      <button (click)="createNode()" title="創建新節點">
        <i class="fa fa-plus"></i> 新增節點
      </button>
    </div>
  </div>

  <div class="visualization-container">
    <div #treeContainer class="tree-visualization"></div>
    <div #tooltip class="custom-tooltip" *ngIf="showTooltip && hoveredNode" [style.left.px]="tooltipX" [style.top.px]="tooltipY">
      {{ hoveredNode.note || '無備註' }}
    </div>
  </div>

  <div *ngIf="selectedNode" class="sidebar">
    <div class="sidebar-header">
      <h3>{{ selectedNode.name }}</h3>
      <span class="node-status" [class.locked]="selectedNode.locked">
        {{ selectedNode.locked ? '已鎖定' : '正常' }}
      </span>
    </div>

    <div class="node-details">
      <div class="detail-item">
        <span class="label">ID:</span>
        <span class="value">{{ selectedNode.id }}</span>
      </div>
      <div class="detail-item">
        <span class="label">層級:</span>
        <span class="value">{{ selectedNode.level }}</span>
      </div>
      <div class="detail-item">
        <span class="label">報告數:</span>
        <span class="value">{{ selectedNode.reports?.length || 0 }}</span>
      </div>
      <div class="detail-item" *ngIf="selectedNode.note">
        <span class="label">備註:</span>
        <span class="value">{{ selectedNode.note }}</span>
      </div>
    </div>

    <div class="node-actions">
      <button (click)="editNode()" [disabled]="selectedNode.locked">
        <i class="fa fa-edit"></i> 編輯
      </button>
      <button (click)="deleteNode()" [disabled]="selectedNode.locked">
        <i class="fa fa-trash"></i> 刪除
      </button>
      <button (click)="toggleLock()">
        <i class="fa" [class.fa-lock]="!selectedNode.locked" [class.fa-unlock]="selectedNode.locked"></i>
        {{ selectedNode.locked ? '解鎖' : '鎖定' }}
      </button>
      <button (click)="linkNode()">
        <i class="fa fa-link"></i> 關聯
      </button>
      <button (click)="highlightSimilarNodes()">
        <i class="fa fa-search"></i> 查找同名
      </button>
    </div>

    <div class="reports-section" *ngIf="selectedNode.reports && selectedNode.reports.length > 0">
      <h4>報告列表</h4>
      <ul class="reports-list">
        <li *ngFor="let report of selectedNode.reports" class="report-item">
          <span class="report-title">{{ report }}</span>
        </li>
      </ul>
      <button (click)="showReports()" class="view-all-reports">
        <i class="fa fa-file-text"></i> 查看所有報告
      </button>
    </div>

    <div class="sidebar-buttons">
      <button pButton 
        type="button" 
        label="新增節點" 
        (click)="createNode()" 
        class="p-button-primary">
      </button>
      <button pButton 
        type="button" 
        label="編輯節點" 
        (click)="editNode()" 
        [disabled]="!selectedNode"
        class="p-button-secondary">
      </button>
      <button pButton 
        type="button" 
        label="取消關聯" 
        (click)="unlinkNode()" 
        [disabled]="!selectedNode"
        class="p-button-warning">
      </button>
      <button pButton 
        type="button" 
        label="查詢關聯" 
        (click)="queryLinkedNodes()" 
        [disabled]="!selectedNode"
        [class.p-button-success]="!isQueryingLinks"
        [class.p-button-danger]="isQueryingLinks">
      </button>
    </div>
  </div>
</div>
