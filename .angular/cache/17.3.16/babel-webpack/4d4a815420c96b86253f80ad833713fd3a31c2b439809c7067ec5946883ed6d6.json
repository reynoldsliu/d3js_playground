{"ast":null,"code":"import * as d3 from 'd3';\nimport * as i0 from \"@angular/core\";\nconst _c0 = [\"treeContainer\"];\nexport let TreeVisualizationComponent = /*#__PURE__*/(() => {\n  class TreeVisualizationComponent {\n    treeContainer;\n    subscription;\n    data = {\n      name: \"Eve\",\n      children: [{\n        name: \"Cain\"\n      }, {\n        name: \"Seth\",\n        children: [{\n          name: \"Enos\"\n        }, {\n          name: \"Noam\"\n        }]\n      }, {\n        name: \"Abel\"\n      }, {\n        name: \"Awan\",\n        children: [{\n          name: \"Enoch\"\n        }]\n      }, {\n        name: \"Azura\"\n      }]\n    };\n    constructor() {}\n    ngOnInit() {}\n    ngAfterViewInit() {\n      const width = 928;\n      // Compute the tree height; this approach will allow the height of the\n      // SVG to scale according to the breadth (width) of the tree layout.\n      const root = d3.hierarchy(this.data);\n      const dx = 10;\n      const dy = width / (root.height + 1);\n      // Create a tree layout.\n      const tree = d3.tree().nodeSize([dx, dy]);\n      // Sort the tree and apply the layout.\n      root.sort((a, b) => d3.ascending(a.data.name, b.data.name));\n      tree(root);\n      // Compute the extent of the tree. Note that x and y are swapped here\n      // because in the tree layout, x is the breadth, but when displayed, the\n      // tree extends right rather than down.\n      let x0 = Infinity;\n      let x1 = -x0;\n      root.each(d => {\n        if (d.x !== undefined && d.x > x1) x1 = d.x;\n        if (d.x !== undefined && d.x < x0) x0 = d.x;\n      });\n      // Compute the adjusted height of the tree.\n      const height = x1 - x0 + dx * 2;\n      const svg = d3.create(\"svg\").attr(\"width\", width).attr(\"height\", height).attr(\"viewBox\", [-dy / 3, x0 - dx, width, height]).attr(\"style\", \"max-width: 100%; height: auto; font: 10px sans-serif;\");\n      // Create the links\n      const links = root.links();\n      const linkGenerator = d3.linkVertical().x(d => d.x).y(d => d.y);\n      const link = svg.append(\"g\").attr(\"fill\", \"none\").attr(\"stroke\", \"#555\").attr(\"stroke-opacity\", 0.4).attr(\"stroke-width\", 1.5).selectAll(\"path\").data(links).join(\"path\").attr(\"d\", d => linkGenerator(d));\n      const node = svg.append(\"g\").attr(\"stroke-linejoin\", \"round\").attr(\"stroke-width\", 3).selectAll().data(root.descendants()).join(\"g\").attr(\"transform\", d => `translate(${d.x ?? 0},${d.y ?? 0})`);\n      node.append(\"circle\").attr(\"fill\", d => d.children ? \"#555\" : \"#999\").attr(\"r\", 2.5);\n      node.append(\"text\").attr(\"dy\", \"0.31em\").attr(\"x\", d => d.children ? -6 : 6).attr(\"text-anchor\", d => d.children ? \"end\" : \"start\").text(d => d.data.name).attr(\"stroke\", \"white\").attr(\"paint-order\", \"stroke\");\n      this.treeContainer.nativeElement.appendChild(svg.node());\n    }\n    resetView() {\n      // Implement reset functionality if needed\n    }\n    ngOnDestroy() {\n      if (this.subscription) {\n        this.subscription.unsubscribe();\n      }\n    }\n    static ɵfac = function TreeVisualizationComponent_Factory(t) {\n      return new (t || TreeVisualizationComponent)();\n    };\n    static ɵcmp = (() => /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: TreeVisualizationComponent,\n      selectors: [[\"app-tree-visualization\"]],\n      viewQuery: function TreeVisualizationComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 7);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.treeContainer = _t.first);\n        }\n      },\n      decls: 6,\n      vars: 0,\n      consts: [[\"treeContainer\", \"\"], [1, \"tree-container\"], [1, \"tree-controls\"], [1, \"reset-button\", 3, \"click\"], [1, \"tree-visualization\"]],\n      template: function TreeVisualizationComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"button\", 3);\n          i0.ɵɵlistener(\"click\", function TreeVisualizationComponent_Template_button_click_2_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.resetView());\n          });\n          i0.ɵɵtext(3, \"\\u91CD\\u7F6E\\u8996\\u5716\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(4, \"div\", 4, 0);\n          i0.ɵɵelementEnd();\n        }\n      },\n      styles: [\".tree-container[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 600px;\\n  border: 1px solid #ccc;\\n  overflow: hidden;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy90cmVlLXZpc3VhbGl6YXRpb24uY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxXQUFBO0VBQ0EsYUFBQTtFQUNBLHNCQUFBO0VBQ0EsZ0JBQUE7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbIi50cmVlLWNvbnRhaW5lciB7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDYwMHB4O1xuICBib3JkZXI6IDFweCBzb2xpZCAjY2NjO1xuICBvdmVyZmxvdzogaGlkZGVuO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n    }))();\n  }\n  return TreeVisualizationComponent;\n})();","map":{"version":3,"names":["d3","TreeVisualizationComponent","treeContainer","subscription","data","name","children","constructor","ngOnInit","ngAfterViewInit","width","root","hierarchy","dx","dy","height","tree","nodeSize","sort","a","b","ascending","x0","Infinity","x1","each","d","x","undefined","svg","create","attr","links","linkGenerator","linkVertical","y","link","append","selectAll","join","node","descendants","text","nativeElement","appendChild","resetView","ngOnDestroy","unsubscribe","selectors","viewQuery","TreeVisualizationComponent_Query","rf","ctx","i0","ɵɵelementStart","ɵɵlistener","TreeVisualizationComponent_Template_button_click_2_listener","ɵɵrestoreView","_r1","ɵɵresetView","ɵɵtext","ɵɵelementEnd","ɵɵelement"],"sources":["/Users/reynolds/cursor/d3js_example2/angular8-app/src/app/components/tree-visualization.component.ts","/Users/reynolds/cursor/d3js_example2/angular8-app/src/app/components/tree-visualization.component.html"],"sourcesContent":["import { Component, OnInit, ElementRef, ViewChild, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport * as d3 from 'd3';\n\ninterface TreeNode {\n  name: string;\n  children?: TreeNode[];\n}\n\n@Component({\n  selector: 'app-tree-visualization',\n  templateUrl: './tree-visualization.component.html',\n  styleUrls: ['./tree-visualization.component.scss']\n})\nexport class TreeVisualizationComponent implements OnInit, AfterViewInit, OnDestroy {\n  @ViewChild('treeContainer', { static: true }) public treeContainer!: ElementRef;\n  private subscription: Subscription | undefined;\n\n  data: TreeNode = {\n    name: \"Eve\",\n    children: [\n      { name: \"Cain\" },\n      { name: \"Seth\", children: [{ name: \"Enos\" }, { name: \"Noam\" }] },\n      { name: \"Abel\" },\n      { name: \"Awan\", children: [{ name: \"Enoch\" }] },\n      { name: \"Azura\" }\n    ]\n  };\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n  ngAfterViewInit(): void {\n    const width = 928;\n\n    // Compute the tree height; this approach will allow the height of the\n    // SVG to scale according to the breadth (width) of the tree layout.\n    const root = d3.hierarchy(this.data);\n    const dx = 10;\n    const dy = width / (root.height + 1);\n\n    // Create a tree layout.\n    const tree = d3.tree<TreeNode>().nodeSize([dx, dy]);\n\n    // Sort the tree and apply the layout.\n    root.sort((a, b) => d3.ascending(a.data.name, b.data.name));\n    tree(root);\n\n    // Compute the extent of the tree. Note that x and y are swapped here\n    // because in the tree layout, x is the breadth, but when displayed, the\n    // tree extends right rather than down.\n    let x0 = Infinity;\n    let x1 = -x0;\n    root.each(d => {\n      if (d.x !== undefined && d.x > x1) x1 = d.x;\n      if (d.x !== undefined && d.x < x0) x0 = d.x;\n    });\n\n    // Compute the adjusted height of the tree.\n    const height = x1 - x0 + dx * 2;\n\n    const svg = d3.create(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .attr(\"viewBox\", [-dy / 3, x0 - dx, width, height])\n      .attr(\"style\", \"max-width: 100%; height: auto; font: 10px sans-serif;\");\n\n    // Create the links\n    const links = root.links();\n    const linkGenerator = d3.linkVertical()\n      .x((d: any) => d.x)\n      .y((d: any) => d.y);\n\n    const link = svg.append(\"g\")\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", \"#555\")\n      .attr(\"stroke-opacity\", 0.4)\n      .attr(\"stroke-width\", 1.5)\n      .selectAll(\"path\")\n      .data(links)\n      .join(\"path\")\n      .attr(\"d\", (d: any) => linkGenerator(d));\n\n    const node = svg.append(\"g\")\n      .attr(\"stroke-linejoin\", \"round\")\n      .attr(\"stroke-width\", 3)\n      .selectAll()\n      .data(root.descendants())\n      .join(\"g\")\n      .attr(\"transform\", d => `translate(${d.x ?? 0},${d.y ?? 0})`);\n\n    node.append(\"circle\")\n      .attr(\"fill\", d => d.children ? \"#555\" : \"#999\")\n      .attr(\"r\", 2.5);\n\n    node.append(\"text\")\n      .attr(\"dy\", \"0.31em\")\n      .attr(\"x\", d => d.children ? -6 : 6)\n      .attr(\"text-anchor\", d => d.children ? \"end\" : \"start\")\n      .text(d => d.data.name)\n      .attr(\"stroke\", \"white\")\n      .attr(\"paint-order\", \"stroke\");\n\n    this.treeContainer.nativeElement.appendChild(svg.node());\n  }\n\n  resetView(): void {\n    // Implement reset functionality if needed\n  }\n\n  ngOnDestroy(): void {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n  }\n}","<div class=\"tree-container\">\n  <div class=\"tree-controls\">\n    <button class=\"reset-button\" (click)=\"resetView()\">重置視圖</button>\n  </div>\n  <div #treeContainer class=\"tree-visualization\"></div>\n</div> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}