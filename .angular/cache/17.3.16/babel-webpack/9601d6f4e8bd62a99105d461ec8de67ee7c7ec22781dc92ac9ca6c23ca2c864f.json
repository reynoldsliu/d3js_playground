{"ast":null,"code":"import * as d3 from 'd3';\nimport * as i0 from \"@angular/core\";\nexport let TreeVisualizationService = /*#__PURE__*/(() => {\n  class TreeVisualizationService {\n    initNodes;\n    svg;\n    root;\n    treeState = {\n      selectedNodes: [],\n      highlightNodes: []\n    };\n    s;\n    constructor() {}\n    getInitNode(data) {\n      if (this.initNodes) {\n        return this.initNodes;\n      }\n      const width = 928;\n      const height = 500;\n      // Compute the tree height; this approach will allow the height of the\n      // this.svg to scale according to the breadth (width) of the tree layout.\n      this.root = d3.hierarchy(data);\n      const dx = 20;\n      const dy = height / (this.root.height + 1);\n      // Create a tree layout.\n      const tree = d3.tree().nodeSize([dx, dy]);\n      // Sort the tree and apply the layout.\n      this.root.sort((a, b) => d3.ascending(a.data.name, b.data.name));\n      tree(this.root);\n      // Compute the extent of the tree.\n      let x0 = Infinity;\n      let x1 = -x0;\n      let y0 = Infinity;\n      let y1 = -y0;\n      this.root.each(d => {\n        if (d.x !== undefined && d.x > x1) {\n          x1 = d.x;\n        }\n        if (d.x !== undefined && d.x < x0) {\n          x0 = d.x;\n        }\n        if (d.y !== undefined && d.y > y1) {\n          y1 = d.y;\n        }\n        if (d.y !== undefined && d.y < y0) {\n          y0 = d.y;\n        }\n      });\n      this.svg = d3.create('svg').attr('width', width).attr('height', height).attr('viewBox', [x0 - dx, y0 - dy, x1 - x0 + dx * 2, y1 - y0 + dy * 2]).attr('style', 'max-width: 100%; height: auto; font: 10px sans-serif;');\n      // Create the links\n      const links = this.root.links();\n      const linkGenerator = d3.linkVertical().x(d => d.x).y(d => d.y);\n      const link = this.svg.append('g').attr('fill', 'none').attr('stroke', '#555').attr('stroke-opacity', 0.4).attr('stroke-width', 1.5).selectAll('path').data(links).join('path').attr('d', d => linkGenerator(d));\n      const node = this.svg.append('g').attr('stroke-linejoin', 'round').attr('stroke-width', 3).selectAll('.node').data(this.root.descendants()).join('g').attr('transform', d => `translate(${d.x ?? 0},${d.y ?? 0})`).on('click', (event, d) => {\n        console.log('click');\n        this.treeState.selectedNodes.push(d);\n        console.log(this.treeState.selectedNodes);\n      }).on('blur', (event, d) => {\n        console.log('blur');\n        this.treeState.selectedNodes = this.treeState.selectedNodes.filter(node => node.id != d.id);\n        console.log(this.treeState.selectedNodes);\n      });\n      node.append('circle').attr('fill', d => d.children ? '#555' : '#999').attr('r', 2.5);\n      node.append('text').attr('dy', '0.31em').attr('x', d => d.children ? -6 : 6).attr('text-anchor', d => d.children ? 'end' : 'start').text(d => d.data.name).attr('stroke', 'white').attr('paint-order', 'stroke');\n      node.append('foreignObject').attr('width', 120).attr('height', 80).attr('x', -60).attr('y', -40).html(d => {\n        // Create custom HTML for each node\n        return `\n      <div class=\"node-container\" style=\"width: 100%; height: 100%;\">\n        <div class=\"node-title\">${d.data.name}</div>\n        <div class=\"node-content\">${d.data.data || ''}</div>\n        <button class=\"node-button\" data-id=\"${d.data.id}\">Details</button>\n      </div>\n    `;\n      });\n      return this.svg.node();\n    }\n    findNode(id) {\n      const targetNode = this.root?.descendants().find(node => node.id === id);\n      if (targetNode) {\n        return targetNode;\n      }\n      return undefined;\n    }\n    getSelectedNodes() {\n      return this.treeState.selectedNodes;\n    }\n    removeSelectedNodes(nodeIds) {\n      nodeIds.forEach(id => {\n        if (id) {\n          const parent = this.root?.find(node => node.id === id)?.parent;\n          const children = parent?.descendants();\n          if (parent && children) {\n            parent.children = children?.filter(d => nodeIds.includes(d.id));\n          }\n        }\n      });\n    }\n    static ɵfac = function TreeVisualizationService_Factory(t) {\n      return new (t || TreeVisualizationService)();\n    };\n    static ɵprov = (() => /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: TreeVisualizationService,\n      factory: TreeVisualizationService.ɵfac\n    }))();\n  }\n  return TreeVisualizationService;\n})();","map":{"version":3,"names":["d3","TreeVisualizationService","initNodes","svg","root","treeState","selectedNodes","highlightNodes","s","constructor","getInitNode","data","width","height","hierarchy","dx","dy","tree","nodeSize","sort","a","b","ascending","name","x0","Infinity","x1","y0","y1","each","d","x","undefined","y","create","attr","links","linkGenerator","linkVertical","link","append","selectAll","join","node","descendants","on","event","console","log","push","filter","id","children","text","html","findNode","targetNode","find","getSelectedNodes","removeSelectedNodes","nodeIds","forEach","parent","includes","factory","ɵfac"],"sources":["/Users/reynolds/cursor/d3js_example2/angular8-app/src/app/services/tree-visualization-service.ts"],"sourcesContent":["import {ElementRef, Injectable} from '@angular/core';\nimport * as d3 from 'd3';\nimport {TreeNode, TreeState} from '../interfaces/interfaces';\nimport {EnterElement} from 'd3';\nimport {Selection} from 'd3-selection';\nimport {HierarchyNode} from 'd3-hierarchy';\n\n@Injectable()\nexport class TreeVisualizationService {\n\n  public initNodes: any;\n  public svg: Selection<any, any, any, any> | undefined;\n  public root: HierarchyNode<any> | undefined;\n  public treeState: TreeState = {selectedNodes: [], highlightNodes: []};\n  public s\n\n  constructor() {\n  }\n\n  getInitNode(data: TreeNode) {\n    if (this.initNodes) {\n      return this.initNodes;\n    }\n\n    const width = 928;\n    const height = 500;\n\n    // Compute the tree height; this approach will allow the height of the\n    // this.svg to scale according to the breadth (width) of the tree layout.\n    this.root = d3.hierarchy(data);\n    const dx = 20;\n    const dy = height / (this.root.height + 1);\n\n    // Create a tree layout.\n    const tree = d3.tree<TreeNode>().nodeSize([dx, dy]);\n\n    // Sort the tree and apply the layout.\n    this.root.sort((a, b) => d3.ascending(a.data.name, b.data.name));\n    tree(this.root);\n\n    // Compute the extent of the tree.\n    let x0 = Infinity;\n    let x1 = -x0;\n    let y0 = Infinity;\n    let y1 = -y0;\n    this.root.each(d => {\n      if (d.x !== undefined && d.x > x1) {\n        x1 = d.x;\n      }\n      if (d.x !== undefined && d.x < x0) {\n        x0 = d.x;\n      }\n      if (d.y !== undefined && d.y > y1) {\n        y1 = d.y;\n      }\n      if (d.y !== undefined && d.y < y0) {\n        y0 = d.y;\n      }\n    });\n\n    this.svg = d3.create('svg')\n      .attr('width', width)\n      .attr('height', height)\n      .attr('viewBox', [x0 - dx, y0 - dy, x1 - x0 + dx * 2, y1 - y0 + dy * 2])\n      .attr('style', 'max-width: 100%; height: auto; font: 10px sans-serif;');\n\n    // Create the links\n    const links = this.root.links();\n    const linkGenerator = d3.linkVertical()\n      .x((d: any) => d.x)\n      .y((d: any) => d.y);\n\n    const link = this.svg.append('g')\n      .attr('fill', 'none')\n      .attr('stroke', '#555')\n      .attr('stroke-opacity', 0.4)\n      .attr('stroke-width', 1.5)\n      .selectAll('path')\n      .data(links)\n      .join('path')\n      .attr('d', (d: any) => linkGenerator(d));\n\n    const node = this.svg.append('g')\n      .attr('stroke-linejoin', 'round')\n      .attr('stroke-width', 3)\n      .selectAll('.node')\n      .data(this.root.descendants())\n      .join('g')\n      .attr('transform', d => `translate(${d.x ?? 0},${d.y ?? 0})`)\n      .on('click', (event, d: TreeNode) => {\n        console.log('click');\n        this.treeState.selectedNodes.push(d);\n        console.log(this.treeState.selectedNodes);\n      })\n      .on('blur', (event, d: TreeNode) => {\n        console.log('blur');\n        this.treeState.selectedNodes =\n          this.treeState.selectedNodes.filter(node => node.id != d.id);\n        console.log(this.treeState.selectedNodes);\n      });\n\n    node.append('circle')\n      .attr('fill', d => d.children ? '#555' : '#999')\n      .attr('r', 2.5);\n\n    node.append('text')\n      .attr('dy', '0.31em')\n      .attr('x', d => d.children ? -6 : 6)\n      .attr('text-anchor', d => d.children ? 'end' : 'start')\n      .text(d => d.data.name)\n      .attr('stroke', 'white')\n      .attr('paint-order', 'stroke');\n\n    node.append('foreignObject')\n      .attr('width', 120)\n      .attr('height', 80)\n      .attr('x', -60)\n      .attr('y', -40)\n      .html(d => {\n        // Create custom HTML for each node\n        return `\n      <div class=\"node-container\" style=\"width: 100%; height: 100%;\">\n        <div class=\"node-title\">${d.data.name}</div>\n        <div class=\"node-content\">${d.data.data || ''}</div>\n        <button class=\"node-button\" data-id=\"${d.data.id}\">Details</button>\n      </div>\n    `;\n      });\n\n    return this.svg.node();\n  }\n\n  findNode(id: string): TreeNode | undefined {\n    const targetNode = this.root?.descendants().find(node => node.id === id);\n    if (targetNode) {\n      return targetNode;\n    }\n    return undefined;\n  }\n\n  getSelectedNodes(): TreeNode[] {\n    return this.treeState.selectedNodes;\n  }\n\n  removeSelectedNodes(nodeIds: (string | undefined)[]): void {\n    nodeIds.forEach((id: string | undefined) => {\n      if (id) {\n        const parent = this.root?.find(node => node.id === id)?.parent;\n        const children = parent?.descendants();\n        if (parent && children) {\n          parent.children = children?.filter(d => nodeIds.includes(d.id));\n        }\n      }\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}