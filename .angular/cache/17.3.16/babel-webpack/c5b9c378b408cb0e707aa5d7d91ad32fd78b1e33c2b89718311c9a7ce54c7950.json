{"ast":null,"code":"import * as d3 from 'd3';\nimport * as i0 from \"@angular/core\";\nexport let TreeVisualizationService = /*#__PURE__*/(() => {\n  class TreeVisualizationService {\n    svg;\n    nodes;\n    links;\n    rects;\n    svgWidth = 928;\n    svgHeight = 500;\n    nodeWidth = 75;\n    nodeHeight = 40;\n    constructor() {}\n    loadTreeData() {\n      return {\n        id: '1',\n        name: 'Eve',\n        level: 0,\n        locked: false,\n        selected: false,\n        reports: ['創世紀報告', '人類起源研究'],\n        children: [{\n          id: '2',\n          name: 'Cain',\n          parentId: '1',\n          level: 1,\n          locked: true,\n          selected: false,\n          reports: ['農業發展計畫']\n        }, {\n          id: '3',\n          name: 'Seth',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['後代傳承方案', '家族發展報告'],\n          children: [{\n            id: '8',\n            name: 'Enos',\n            parentId: '3',\n            level: 2,\n            locked: false,\n            selected: false,\n            reports: ['宗教研究初探']\n          }, {\n            id: '9',\n            name: 'Noam',\n            parentId: '3',\n            level: 2,\n            locked: false,\n            selected: false,\n            reports: []\n          }]\n        }, {\n          id: '4',\n          name: 'Abel',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['牧羊技術報告']\n        }, {\n          id: '5',\n          name: 'Awan',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['工藝發展史'],\n          children: [{\n            id: '10',\n            name: 'Enoch',\n            parentId: '5',\n            level: 2,\n            locked: false,\n            selected: false,\n            reports: ['城市規劃初步', '建築學基礎']\n          }]\n        }, {\n          id: '6',\n          name: 'Azura',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: []\n        }, {\n          id: '7',\n          name: 'Awan',\n          // 故意重複的公司名稱，用於測試「選取同公司提示」功能\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['另一部門的工藝報告']\n        }]\n      };\n    } // TODO\n    performAction() {} // TODO\n    initializeTree(data) {\n      // Create hierarchy and apply tree layout\n      const root = d3.hierarchy(data);\n      // Using nodeSize sets the spacing between nodes\n      const tree = d3.tree().nodeSize([this.nodeWidth * 1.5, this.nodeHeight * 2]);\n      // Apply layout to calculate positions\n      tree(root);\n      // Create SVG\n      this.svg = d3.select('.tree-visualization').append('svg').attr('width', this.svgWidth).attr('height', this.svgHeight).attr('viewBox', [0, 0, this.svgWidth, this.svgHeight]).attr('style', 'max-width: 100%; height: auto; font: 10px sans-serif;');\n      // Create a group to hold all elements with a margin\n      const g = this.svg.append('g').attr('transform', `translate(${this.svgWidth / 2}, ${this.nodeHeight})`);\n      // Create links first (so they appear behind nodes)\n      this.links = g.selectAll('.link').data(root.links()).enter().append('path').attr('class', 'link').attr('d', d3.linkVertical().x(d => d.x) // Use natural x,y for vertical layout\n      .y(d => d.y)).style('fill', 'none').style('stroke', '#000000').style('stroke-width', '1.5px');\n      // Create node groups\n      this.nodes = g.selectAll('.node').data(root.descendants()).enter().append('g').attr('class', 'node').attr('transform', d => `translate(${d.x},${d.y})`);\n      // Add rectangles to nodes - centered on node position\n      this.nodes.append('rect').attr('width', this.nodeWidth).attr('height', this.nodeHeight).attr('x', -this.nodeWidth / 2) // Center the rectangle on the node\n      .attr('y', -this.nodeHeight / 2) // Center the rectangle on the node\n      .style('fill', '#69b3a2').style('stroke', '#000').attr('rx', 5) // Rounded corners\n      .attr('ry', 5);\n      // Add text labels\n      this.nodes.append('text').attr('dy', '0.3em').attr('text-anchor', 'middle').text(d => d.data.name).style('fill', 'white').style('font-size', '12px');\n      return this.svg.node();\n    }\n    // TODO 處理節點點擊事件\n    handleNodeClick(node) {\n      // this.selectedNodeSubject.next(node.data);\n      // TODO 更新樹狀圖中的選中狀態...\n    }\n    // TODO 處理按鈕點擊事件\n    handleButtonClick(event, buttonData) {\n      const companyId = d3.select(event.target.closest('.node')).attr('id').replace('company-', '');\n      // TODO 根據按鈕類型執行對應操作...\n    }\n    // TODO 顯示公司報告\n    showCompanyReports(company) {\n      // TODO 發出事件通知應用程式顯示報告列表...\n    }\n    // 尋找相同公司並提示\n    highlightSameCompany(companyName) {\n      d3.selectAll('.node').classed('highlight-similar', d => d && d.data && d.data.name === companyName);\n    }\n    static ɵfac = function TreeVisualizationService_Factory(t) {\n      return new (t || TreeVisualizationService)();\n    };\n    static ɵprov = (() => /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: TreeVisualizationService,\n      factory: TreeVisualizationService.ɵfac\n    }))();\n  }\n  return TreeVisualizationService;\n})();","map":{"version":3,"names":["d3","TreeVisualizationService","svg","nodes","links","rects","svgWidth","svgHeight","nodeWidth","nodeHeight","constructor","loadTreeData","id","name","level","locked","selected","reports","children","parentId","performAction","initializeTree","data","root","hierarchy","tree","nodeSize","select","append","attr","g","selectAll","enter","linkVertical","x","d","y","style","descendants","text","node","handleNodeClick","handleButtonClick","event","buttonData","companyId","target","closest","replace","showCompanyReports","company","highlightSameCompany","companyName","classed","factory","ɵfac"],"sources":["/Users/reynolds/cursor/d3js_example2/angular8-app/src/app/services/tree-visualization-service.ts"],"sourcesContent":["import {ElementRef, Injectable} from '@angular/core';\nimport * as d3 from 'd3';\nimport {TreeNode} from '../interfaces/interfaces';\nimport {Selection} from 'd3-selection';\nimport {HierarchyNode} from 'd3-hierarchy';\nimport {BehaviorSubject} from 'rxjs';\n\n@Injectable()\nexport class TreeVisualizationService {\n\n  public svg: any;\n  public nodes: any;\n  public links: any;\n  public rects: any;\n\n  public svgWidth = 928;\n  public svgHeight = 500;\n  public nodeWidth = 75;\n  public nodeHeight = 40;\n\n  constructor() {\n  }\n\n  public loadTreeData(): TreeNode {\n    return {\n      id: '1',\n      name: 'Eve',\n      level: 0,\n      locked: false,\n      selected: false,\n      reports: ['創世紀報告', '人類起源研究'],\n      children: [\n        {\n          id: '2',\n          name: 'Cain',\n          parentId: '1',\n          level: 1,\n          locked: true,\n          selected: false,\n          reports: ['農業發展計畫']\n        },\n        {\n          id: '3',\n          name: 'Seth',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['後代傳承方案', '家族發展報告'],\n          children: [\n            {\n              id: '8',\n              name: 'Enos',\n              parentId: '3',\n              level: 2,\n              locked: false,\n              selected: false,\n              reports: ['宗教研究初探']\n            },\n            {\n              id: '9',\n              name: 'Noam',\n              parentId: '3',\n              level: 2,\n              locked: false,\n              selected: false,\n              reports: []\n            }\n          ]\n        },\n        {\n          id: '4',\n          name: 'Abel',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['牧羊技術報告']\n        },\n        {\n          id: '5',\n          name: 'Awan',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['工藝發展史'],\n          children: [\n            {\n              id: '10',\n              name: 'Enoch',\n              parentId: '5',\n              level: 2,\n              locked: false,\n              selected: false,\n              reports: ['城市規劃初步', '建築學基礎']\n            }\n          ]\n        },\n        {\n          id: '6',\n          name: 'Azura',\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: []\n        },\n        {\n          id: '7',\n          name: 'Awan',  // 故意重複的公司名稱，用於測試「選取同公司提示」功能\n          parentId: '1',\n          level: 1,\n          locked: false,\n          selected: false,\n          reports: ['另一部門的工藝報告']\n        }\n      ]\n    } as TreeNode;\n  } // TODO\n\n  public performAction(): void {} // TODO\n\n  public initializeTree(data: TreeNode | undefined) {\n\n    // Create hierarchy and apply tree layout\n    const root = d3.hierarchy(data) as HierarchyNode<unknown>;\n\n    // Using nodeSize sets the spacing between nodes\n    const tree = d3.tree().nodeSize([this.nodeWidth * 1.5, this.nodeHeight * 2]);\n\n    // Apply layout to calculate positions\n    tree(root);\n\n    // Create SVG\n    this.svg = d3.select('.tree-visualization')\n      .append('svg')\n      .attr('width', this.svgWidth)\n      .attr('height', this.svgHeight)\n      .attr('viewBox', [0, 0, this.svgWidth, this.svgHeight])\n      .attr('style', 'max-width: 100%; height: auto; font: 10px sans-serif;');\n\n    // Create a group to hold all elements with a margin\n    const g = this.svg.append('g')\n      .attr('transform', `translate(${this.svgWidth / 2}, ${this.nodeHeight})`);\n\n    // Create links first (so they appear behind nodes)\n    this.links = g.selectAll('.link')\n      .data(root.links())\n      .enter()\n      .append('path')\n      .attr('class', 'link')\n      .attr('d', d3.linkVertical()\n        .x((d:any) => d.x)  // Use natural x,y for vertical layout\n        .y((d:any) => d.y) as any)\n      .style('fill', 'none')\n      .style('stroke', '#000000')\n      .style('stroke-width', '1.5px');\n\n    // Create node groups\n    this.nodes = g.selectAll('.node')\n      .data(root.descendants())\n      .enter()\n      .append('g')\n      .attr('class', 'node')\n      .attr('transform', (d: { x: any; y: any; }) => `translate(${d.x},${d.y})`);\n\n    // Add rectangles to nodes - centered on node position\n    this.nodes.append('rect')\n      .attr('width', this.nodeWidth)\n      .attr('height', this.nodeHeight)\n      .attr('x', -this.nodeWidth / 2)  // Center the rectangle on the node\n      .attr('y', -this.nodeHeight / 2) // Center the rectangle on the node\n      .style('fill', '#69b3a2')\n      .style('stroke', '#000')\n      .attr('rx', 5) // Rounded corners\n      .attr('ry', 5);\n\n    // Add text labels\n    this.nodes.append('text')\n      .attr('dy', '0.3em')\n      .attr('text-anchor', 'middle')\n      .text((d: { data: TreeNode; }) => (d.data as TreeNode).name)\n      .style('fill', 'white')\n      .style('font-size', '12px');\n\n    return this.svg.node();\n  }\n\n  // TODO 處理節點點擊事件\n  private handleNodeClick(node: d3.HierarchyNode<TreeNode>) {\n    // this.selectedNodeSubject.next(node.data);\n    // TODO 更新樹狀圖中的選中狀態...\n  }\n\n  // TODO 處理按鈕點擊事件\n  private handleButtonClick(event: any, buttonData: any) {\n    const companyId = d3.select(event.target.closest('.node')).attr('id').replace('company-', '');\n    // TODO 根據按鈕類型執行對應操作...\n  }\n\n  // TODO 顯示公司報告\n  private showCompanyReports(company: TreeNode) {\n    // TODO 發出事件通知應用程式顯示報告列表...\n  }\n\n  // 尋找相同公司並提示\n  highlightSameCompany(companyName: string): void {\n    d3.selectAll('.node').classed('highlight-similar', d =>\n      d && (d as any).data && (d as any).data.name === companyName\n    );\n  }\n\n\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}